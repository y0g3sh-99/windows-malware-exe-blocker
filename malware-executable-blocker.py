## Yogesh Ingale
## Some well known executables entries are added in malware-exe-list.txt file, especially the launchers of different malwares, which trigger various malicious tasks.
## Those are files created/added by malwares to start/execute actual malicious activities.
## These are collected from good blogs of complete analysis from carbon black, sophos, symantec, malwarebytes, kaspersky etc
## As of now, I don't know their hashes (in same format), so going to block those from running, if same name found.
## Please add new file entries in separate line when you'll know more malware or suspicious executables, .bat, .com
## I will keep updating txt file when I get new launchers/exe/bat of different malwares.

from winreg import *
import re, os

try:
    key = CreateKey(HKEY_CURRENT_USER, r"Software\Microsoft\Windows\CurrentVersion\Policies\Explorer")
    SetValueEx(key, 'DisallowRun', 0, REG_DWORD, 1)
    key1=CreateKey(key, "DisallowRun")

    li=[]
    if os.path.exists("malware-exe-list.txt"):
        for i in open("malware-exe-list.txt").readlines():
            i = i.replace("\n", "")
            if re.search("^[a-zA-Z\d\{]", i):
                li.append(i)

    if len(li) == 0:
        print("\nPlease ensure the latest malware-exe-list.txt file is present at same location of this file and it has entries to block.")
    
    print("List of files to block: %s"%li)
    
    checkkey=[]
    checkval=[]
    i=0
    while True:
        try:
            val = EnumValue(key1,i)[1].lower()
            k = EnumValue(key1,i)[0].lower()
            i = i + 1
            checkval.append(val)
            checkkey.append(k)
        except:
            break

    flag = 0
    k = 1
    for i in li:
        if i.lower() not in checkval:
            while str(k)  in checkkey:
                k = k + 1
                
            SetValueEx(key1, str(k), 0, REG_SZ, i)
            flag = 1
            k = k + 1
            print ("%s is now blocked to execute."%i)

    if flag == 0 and len(li) > 0:
        print("\nAll these files are already blocked, if you want to block more files then please add the entry in malware-exe-list.txt file and run again.")
        
except:
    print("Please run the script as administrator!")

input("\nPress enter to exit, thanks :)")
